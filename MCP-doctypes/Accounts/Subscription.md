# Master Control Plan: `Subscription`

## 1. Doctype Schema & Metadata

### Core Properties
- **Module:** `Accounts`
- **Custom:** `0`
- **Is Table:** `0`
- **Is Submittable:** `0`
- **Autoname:** `ACC-SUB-.YYYY.-.#####`
- **Description:** None

### Permissions
| Role | Read | Write | Create | Delete | Submit | Cancel | Amend | Report | Import | Export | Print | Email | Share | Set User Perms |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| System Manager | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ✅ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ |
| Accounts User | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ✅ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ |
| Accounts Manager | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ✅ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ |


### Fields (Standard)
| Fieldname | Label | Type | Options | Required | Hidden | Read Only | Default | Description |
|---|---|---|---|---|---|---|---|---|
| `party_type` | Party Type | Link | DocType | ✅ |  |  | None | None |
| `party` | Party | Dynamic Link | party_type | ✅ |  |  | None | None |
| `cb_1` | None | Column Break | None |  |  |  | None | None |
| `company` | Company | Link | Company |  |  |  | None | None |
| `status` | Status | Select | 
Trialing
Active
Past Due Date
Cancelled
Unpaid
Completed |  |  | ✅ | None | None |
| `subscription_period` | Subscription Period | Section Break | None |  |  |  | None | None |
| `start_date` | Subscription Start Date | Date | None |  |  |  | None | None |
| `end_date` | Subscription End Date | Date | None |  |  |  | None | None |
| `cancelation_date` | Cancelation Date | Date | None |  |  | ✅ | None | None |
| `trial_period_start` | Trial Period Start Date | Date | None |  |  |  | None | None |
| `trial_period_end` | Trial Period End Date | Date | None |  |  |  | None | None |
| `follow_calendar_months` | Follow Calendar Months | Check | None |  |  |  | 0 | If this is checked subsequent new invoices will be created on calendar  month and quarter start dates irrespective of current invoice start date |
| `generate_new_invoices_past_due_date` | Generate New Invoices Past Due Date | Check | None |  |  |  | 0 | New invoices will be generated as per schedule even if current invoices are unpaid or past due date |
| `submit_invoice` | Submit Generated Invoices | Check | None |  |  |  | 1 | None |
| `column_break_11` | None | Column Break | None |  |  |  | None | None |
| `current_invoice_start` | Current Invoice Start Date | Date | None |  |  | ✅ | None | None |
| `current_invoice_end` | Current Invoice End Date | Date | None |  |  | ✅ | None | None |
| `days_until_due` | Days Until Due | Int | None |  |  |  | 0 | Number of days that the subscriber has to pay invoices generated by this subscription |
| `generate_invoice_at` | Generate Invoice At | Select | End of the current subscription period
Beginning of the current subscription period
Days before the current subscription period | ✅ |  |  | End of the current subscription period | None |
| `number_of_days` | Number of Days | Int | None |  |  |  | None | None |
| `cancel_at_period_end` | Cancel At End Of Period | Check | None |  |  |  | 0 | None |
| `sb_4` | Plans | Section Break | None |  |  |  | None | None |
| `plans` | Plans | Table | Subscription Plan Detail | ✅ |  |  | None | None |
| `sb_1` | Taxes | Section Break | None |  |  |  | None | None |
| `sales_tax_template` | Sales Taxes and Charges Template | Link | Sales Taxes and Charges Template |  |  |  | None | None |
| `purchase_tax_template` | Purchase Taxes and Charges Template | Link | Purchase Taxes and Charges Template |  |  |  | None | None |
| `sb_2` | Discounts | Section Break | None |  |  |  | None | None |
| `apply_additional_discount` | Apply Additional Discount On | Select | 
Grand Total
Net Total |  |  |  | None | None |
| `cb_2` | None | Column Break | None |  |  |  | None | None |
| `additional_discount_percentage` | Additional Discount Percentage | Percent | None |  |  |  | None | None |
| `additional_discount_amount` | Additional Discount Amount | Currency | None |  |  |  | None | None |
| `accounting_dimensions_section` | Accounting Dimensions | Section Break | None |  |  |  | None | None |
| `cost_center` | Cost Center | Link | Cost Center |  |  |  | None | None |


### Custom Fields
No custom fields found.


### Links & Relationships
- **Link Fields:** 5
- **Dynamic Link Fields:** 1
- **Table Fields:** 1

## 2. Server-Side Controller (`.py`)
Could not get document class.


## 3. Client-Side Scripts (`.js` & Custom Script)
### File-Based Script
**Path:** `/workspace/cohenix-bench/apps/erpnext/erpnext/accounts/doctype/subscription/subscription.js`
```javascript
// Copyright (c) 2018, Frappe Technologies Pvt. Ltd. and contributors
// For license information, please see license.txt

frappe.ui.form.on("Subscription", {
	setup: function (frm) {
		frm.set_query("party_type", function () {
			return {
				filters: {
					name: ["in", ["Customer", "Supplier"]],
				},
			};
		});

		frm.set_query("cost_center", function () {
			return {
				filters: {
					company: frm.doc.company,
				},
			};
		});

		frm.set_query("sales_tax_template", function () {
			return {
				filters: {
					company: frm.doc.company,
				},
			};
		});
	},

	refresh: function (frm) {
		if (frm.is_new()) return;

		if (frm.doc.status !== "Cancelled") {
			frm.add_custom_button(
				__("Fetch Subscription Updates"),
				() => frm.trigger("get_subscription_updates"),
				__("Actions")
			);

			frm.add_custom_button(
				__("Force-Fetch Subscription Updates"),
				() => frm.trigger("force_fetch_subscription_updates"),
				__("Actions")
			);

			frm.add_custom_button(
				__("Cancel Subscription"),
				() => frm.trigger("cancel_this_subscription"),
				__("Actions")
			);
		} else if (frm.doc.status === "Cancelled") {
			frm.add_custom_button(
				__("Restart Subscription"),
				() => frm.trigger("renew_this_subscription"),
				__("Actions")
			);
		}
	},

	cancel_this_subscription: function (frm) {
		frappe.confirm(
			__("This action will stop future billing. Are you sure you want to cancel this subscription?"),
			() => {
				frm.call("cancel_subscription").then((r) => {
					if (!r.exec) {
						frm.reload_doc();
					}
				});
			}
		);
	},

	renew_this_subscription: function (frm) {
		frappe.confirm(__("Are you sure you want to restart this subscription?"), () => {
			frm.call("restart_subscription").then((r) => {
				if (!r.exec) {
					frm.reload_doc();
				}
			});
		});
	},

	get_subscription_updates: function (frm) {
		frm.call("process").then((r) => {
			if (!r.exec) {
				frm.reload_doc();
			}
		});
	},
	force_fetch_subscription_updates: function (frm) {
		frm.call("force_fetch_subscription_updates").then((r) => {
			if (!r.exec) {
				frm.reload_doc();
			}
		});
	},
});

```




## 4. Workflow Automation
No active workflows found for this DocType.


## 5. Reports & Analytics
### Linked Reports
No linked reports found.


### Dashboard Charts
No dashboard charts found.


### Number Cards
No number cards found.


## 6. System Automations
### Email Alerts
No enabled email alerts found.


### Notifications
No enabled notifications found.


### Webhooks
No enabled webhooks found.
